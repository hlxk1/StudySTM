# StudySTM
Study knowledge about STM32

## STM32与ARM的关系

![image-20241109184337399](.\img\image-20241109184337399.png)

ARM公司负责芯片方案设计

ST负责制造芯片

![image-20241109185228634](.\img\image-20241109185228634.png)

STM32f103就属于Cortex—M3

![image-20241109185429564](.\img\image-20241109185429564.png)

STM32拿到ARM设计的内核，STM32基于这个内核添加了自己公司的外设进行打包，封装，生产

![image-20241109185701632](.\img\image-20241109185701632.png)

L:代表低功耗

F1和F4比较主流性价比高

## STM32F103C8T6介绍

![image-20241109185935538](.\img\image-20241109185935538.png)

https://www.stmcu.com.cn/

logo:ST表示由ST公司生产，通常芯片表面还会有一个ARM（内核基于ARM公司设计）

一般芯片上还会有个**圆点针对芯片管脚的顺序（按逆时针）**

------

![image-20241109191021165](.\img\image-20241109191021165.png)

通过这张图（在STM32选型表中）可以看到不同芯片的外设资源数目

------

![image-20241109191250443](.\img\image-20241109191250443.png)

![image-20241109191254519](.\img\image-20241109191254519.png)

这就是STM32F103C8T6的外设资源

------

![image-20241109191523534](.\img\image-20241109191523534.png)

**芯片上型号的规则**

------

## 芯片管脚

![image-20241109192743952](.\img\image-20241109192743952.png)

芯片引脚的功能

![image-20241109192933633](.\img\image-20241109192933633.png)

## STM32能做什么

![image-20241109193015834](.\img\image-20241109193015834.png)

## STM32学习方法

### 1 基本外设

GPIO 输入输出，外部中断，定时器，串口。

### 2 基本外设接口

SPI，IIC，WDG，FSMC，ADC/DAC,SDIO等

### 3 高级功能

RTOS，LWIP，FATFS，GUI，USB等

### 4 提升C语言，多编程，多查找

## STM32最小系统

### STM32 最小系统构成

#### 1 晶振电路

![image-20241109194640166](.\img\image-20241109194640166.png)

下方为主晶振

D2为发光二极管，便于调试提示我们连接到了PC13的管脚

#### 2 复位电路

![image-20241109194650673](.\img\image-20241109194650673.png)

NRST引脚及低电平复位

RST是加上按键

#### 3 电源电路

![image-20241109194813060](.\img\image-20241109194813060.png)

![image-20241109195202471](F:\StudySTM\img\image-20241109195202471.png)

![image-20241109195309819](.\img\image-20241109195309819.png)

稳压芯片将5V电压变为3.3V

#### 4 下载电路

![image-20241109194928506](.\img\image-20241109194928506.png)

只需要两个引脚SWDIO，SWCLK，通过添加供电引脚方便仿真器供电

------

![image-20241109195559799](.\img\image-20241109195559799.png)

![image-20241109195608775](.\img\image-20241109195608775.png)

VDD是电源正极，VSS是电源负极

### STM32启动模式

![image-20241109195830986](.\img\image-20241109195830986.png)

![image-20241109200005470](.\img\image-20241109200005470.png)

类似图中的 BOOT0 标识的叫做**网络标号**

## Keil5软件安装及配置

### 1 Keil5获取

官网：https://www.keil.com/download/product/

![image-20241109203354502](.\img\image-20241109203354502.png)

STM32是基于MDK-Arm下载

下载过程提示你安装一些jlink驱动，可以安装或不安装

### 2 添加STM32的芯片包

![image-20241109203715429](.\img\image-20241109203715429.png)

#### 点击新建项目新建文件验证是否有芯片包

![image-20241109203936522](.\img\image-20241109203936522.png)

![image-20241109204058623](.\img\image-20241109204058623.png)

### 3 破解Keil5

![image-20241109204148719](.\img\image-20241109204148719.png)

破解的注册及软件

![image-20241109204251497](.\img\image-20241109204251497.png)

点击License Management管理

------

![image-20241109204333043](.\img\image-20241109204333043.png)

复制CID

![image-20241109204419133](.\img\image-20241109204419133.png)

将注册机打开选择Target为ARM（如果是51单片机才选择C51）,并把复制好的CID填入

点击Generate，生成的码复制写入 License ID Code

![image-20241109204649868](.\img\image-20241109204649868.png)

### 修改编码风格

![image-20241109205315760](.\img\image-20241109205315760.png)

 

## STM32固件库介绍

### 1 CMSIS标准 

CMSIS是Cortex Microcontroller Software Interface Standard英文首字母缩写，是ARM Cortex微控制器软件接口标准

![image-20241110000504395](.\img\image-20241110000504395.png)







### 2 库目录文件

![image-20241110001628161](.\img\image-20241110001628161.png)

![image-20241110001646512](.\img\image-20241110001646512.png)

![image-20241110001703803](.\img\image-20241110001703803.png)

#### 文件介绍

![image-20241110002011496](.\img\image-20241110002011496.png)

##### 启动文件startup

![image-20241110002049450](.\img\image-20241110002049450.png)

![image-20241110002111752](.\img\image-20241110002111752.png)

根据这个表选择对应的型号的启动文件（看缩写）

### 3 库帮组文档使用

![image-20241119211258746](.\img\image-20241119211258746.png)

对函数功能的了解

## 库函数模板创建

### 获取固件库

![image-20241119212021778](.\img\image-20241119212021778.png)

### 工程模板拷贝

![image-20241119212554123](.\img\image-20241119212554123.png)

![image-20241119212858391](.\img\image-20241119212858391.png)

------

CMSIS中的文件有**内核支持文件**core_cm3.c .h,**启动文件**startup_stm32f10x_md.s,**系统时钟文件**

![image-20241119213218147](.\img\image-20241119213218147.png)

![image-20241119213535907](.\img\image-20241119213535907.png)

![image-20241119213909187](.\img\image-20241119213909187.png)

------

user文件夹下

![image-20241119214433707](.\img\image-20241119214433707.png)

![image-20241119214655916](.\img\image-20241119214655916.png)

### 创建工程添加文件

![image-20241119215254608](.\img\image-20241119215254608.png)

![image-20241119215308725](.\img\image-20241119215308725.png)

![image-20241119215322907](.\img\image-20241119215322907.png)

![image-20241119215344260](.\img\image-20241119215344260.png)

在ok后弹出的运行管理（manege run...enviroment）窗口关掉就好了

![image-20241119220034108](.\img\image-20241119220034108.png)

![image-20241119220309679](.\img\image-20241119220309679.png)

------

![image-20241119221007931](.\img\image-20241119221007931.png)

![image-20241119221016446](.\img\image-20241119221016446.png)

在CMSIS肯看不到.s后缀的文件，需要在下面通配符选择所有文件可见

![image-20241119221104379](.\img\image-20241119221104379.png)

这是添加源文件，头文件链接就好不需要添加进来对于外设接口

![image-20241119221143387](.\img\image-20241119221143387.png)

![image-20241119221432708](.\img\image-20241119221432708.png)

#### 最终模板

![image-20241119221631325](.\img\image-20241119221631325.png)

### 工程中参数设置

![image-20241119223443868](.\img\image-20241119223443868.png)

![image-20241119223456616](.\img\image-20241119223456616.png)

![image-20241119223508617](.\img\image-20241119223508617.png)

![image-20241119223518240](F:\StudySTM\img\image-20241119223518240.png)

![image-20241119223529505](.\img\image-20241119223529505.png)

每一步配置好参数点击OK才能应用，然后把复制过来的main.c模板文件清空写自己的文件，一般一个程序都有一个死循环，目的就是能完成一个功能它能一直展现。游戏也是如此

![image-20241119224726350](.\img\image-20241119224726350.png)

------

#### 二、解决编译报错

![image-20241119225238010](.\img\image-20241119225238010.png)

在添加下面这个宏，为的是当使用不是芯片自带的外设不属于它时，需要这个宏才不会报错

![image-20241119230520873](.\img\image-20241119230520873.png)

要在宏里添加个英文分号;来添加第二个宏

![image-20241119230646754](.\img\image-20241119230646754.png)

这样编译器就打开了这些外设

#### 三、关于编译

![image-20241119231133778](.\img\image-20241119231133778.png)

### 启动文件

从复位道开始执行main函数的工作

**开发攻略-库函数模板介绍**中有详解

1.初始化堆栈指针sp

![image-20241119233138508](.\img\image-20241119233138508.png)



2.初始化pc指针，执行对应

3.初始化中断向量表

4.配置系统时钟

## GPIO

是通用输入输出端口简称，通过软件来控制其输入输出

![image-20241119233429651](.\img\image-20241119233429651.png)

这个学习板F103有48个引脚

**1.电源引脚**

带有VSSA，VDDA，VDD，VSS的网络标识符为电源引脚**VSS(电源负极)**，**VDD(电源正极)**

**2.晶振引脚**

OSC32

**3.复位引脚**

NRST,N表示要低电平，RST表示复位

**4.下载引脚**

 SWD

**5.BOOT引脚**



**6.GPIO引脚**

PA，PB,PC,PD

通过芯片手册来查看不同管脚功能

### 一、GPIO结构框图

![image-20241119234510456](.\img\image-20241119234510456.png)

 

------

#### 保护二极管电路

![image-20241119235745429](.\img\image-20241119235745429.png)

保护二极管电路，目的是防止外部过高或过低的电压引入。

**若外部电压过高**，大于VDD_FT或Vdd的时候，上方二极管起到保护作用吸收该高电压

**若外部电压低于Vss时**，下部二极管起到保护作用吸收这个低电压。

防止外部电压不正常导致芯片烧坏。

**但是若连接的是一些大功率器件**的话，比如电机是会烧坏器件的，要在电机和IO引脚之间增加一个驱动电路

------

#### 1.上下拉电路

![image-20241120000420990](.\img\image-20241120000420990.png)

这些开关可通过程序来断开和闭合。

上面闭合，下面断开：**上拉模式**，io引脚为高电平，*其驱动能力较弱，可在外部增加一个上拉电阻*

下面闭合，上面断开：**下拉模式**，io引脚为低电平

都断开：**浮空模式**，引脚电压不确定

------

#### 2.输出驱动

![image-20241120000919005](.\img\image-20241120000919005.png)

##### **推挽输出**：

当输出驱动电路输出高电平1时，P-MOS导通，M-MOS截止，对外输出的是高电平

当输出驱动电路输出低电平0时，P-MOS截止，M-MOS导通，对外输出的是低电平

当切换输出高低电平，那就轮流导通两个MOS，有助于管脚驱动能力提高

##### **开漏输出**：

P-MOS管都是断开的，只有M-MOS有用，

输出低电平M-MOS导通。

输出高电平时M-MOS是不通的，

要输出高电平要在io引脚做一个上拉才能。

**案例：**

要让管脚输出大于3.3V的电平如5V，选择开漏模式，依靠外部上拉电阻接入5V电压。

------

#### 3.寄存器

##### 输出数据寄存器

通过输出数据寄存器中的值改变管脚高低电平的输出

##### 位设置/清楚寄存器

来改变输出数据寄存器的值来到大引脚输出电平改变

##### 片上外设数据寄存器

通过其它外设来改变复用功能输出来改变输出驱动电路的高低电平让管脚电平发生改变

对于复用功能也是一样，对片上外设复用功能输入传到片上外设寄存器

##### 输入数据寄存器

通过io口经过上下拉电阻，经过TTL施密特触发器（将信号转化为0或1）存入到输入数据寄存器，从而读取到管脚接收的电平状态，

------

#### 4.模拟输入

没有经过TTL施密特触发器,得到的使原始信号，通常应用于ADC数据采集。模拟信号转为数字信号

也有DAC功能：是输出模式，输出数字信号

### 二、硬件设计

![image-20241120004035360](.\img\image-20241120004035360.png)

如上图LED灯特性可知，需要一个引脚输出低电平就能实现点亮，所以控制引脚高低电平就能实现开关灯

### 三、点亮第一个LED灯

7.5
