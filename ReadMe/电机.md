# 电机

## 直流电机

![image-20241125223528046](.\img\image-20241125223528046.png)

![image-20241125223604462](.\img\image-20241125223604462.png)

根据右手螺旋定则判断转向

直流电机是指能将直流电能转换成机械能（直流电动机）或将机械能转换成直流电能（直流发电机）的旋转电机。

**单片机主要是用来控制而非驱动，如果直接使用芯片的 GPIO 管脚去驱动大功率器件，要么将芯片烧坏，要么就驱动不起来。所以要驱动大功率器件，比如电机。就必须搭建驱动电路**

### 一、ULN2003芯片驱动电路

(1) 主要特点

①500mA 额定集电极电流（单个输出）

②高电压输出：50V

③输入和各种逻辑类型兼容

④继电器驱动器

![](.\img\image-20241125223959257.png)

该芯片是一个单片高电压、高电流的达林顿晶体管阵列集成电路。不仅可以用来驱动直流电机，还可用来驱动五线四相步进电机，比如 28BYJ48 步进电机。

它是由7 对 **NPN 达林顿管**组成的，它的高电压输出特性和阴极箝位二极管可以转换感应负载。单个达林顿对的集电极电流是 500mA。达林顿管并联可以承受更大的电流。此电路主要应用于继电器驱动器，字锤驱动器，灯驱动器，显示驱动器（LED 气体放电），线路驱动器和逻辑缓冲器。ULN2003 的每对达林顿管都有一个 2.7k串联电阻，可以直接和 TTL 或 5V CMOS 装置。

```
如上图，当1B由芯片引脚输出高电平时，经过非门电机接的一端1C为低电平，所以当电机另一端接COM为5V电机形成回路电机被驱动，
相反1B为低电平就使1C高电平，形成高阻态
```

从上图可以很容易理解该芯片的使用方法，其内部相当于非门电路，即输入高输出为低，输入为低输出是高组态，这里要注意：**因为 ULN2003 的输出是集电极开路，ULN2003 要输出高电平，必须在输出口外接上拉电阻**。**这也就能解释在后面连接直流电机时为什么不能直接将 ULN2003 的 2 个输出口接电机线，而必须一根线接电源，另一个才接 ULN2003 输出口。**若使用该芯片驱动直流电机，只可实现单方向控制，电机一端接电源正极，另一端接芯片的输出口。若想控制五线四相步进电机，则可将四路输出接到步进电机的四相上，电机另一条线接电源正。

### 二、硬件设计

![image-20241125225251425](.\img\image-20241125225251425.png)

### 三、软件设计

直流电机间隔约1S启动和停止

#### dc_motor.h

```
#ifndef _DC_MOTOR_H
#define _DC_MOTOR_H

#include "system.h"
#include "systick.h"

#define DC_MOTOR_PORT GPIOB
#define DC_MOTOR_PIN GPIO_Pin_8
#define DC_MOTOR_PORT_RCC RCC_APB2Periph_GPIOB

#define DC_MOTOR PBout(8)

void DC_MOTOR_Init(void);

#endif

```

#### dc_motor.c

```
#include "dc_motor.h"
void DC_MOTOR_Init()
{
	GPIO_InitTypeDef GPIO_InitStruct;
	// 开启时钟GPIO挂接的时钟
	RCC_APB2PeriphClockCmd(DC_MOTOR_PORT_RCC, ENABLE);
	
	GPIO_InitStruct.GPIO_Mode=GPIO_Mode_Out_PP;
	GPIO_InitStruct.GPIO_Pin=DC_MOTOR_PIN;
	GPIO_InitStruct.GPIO_Speed=GPIO_Speed_50MHz;
	GPIO_Init(DC_MOTOR_PORT, &GPIO_InitStruct);
	GPIO_ResetBits(DC_MOTOR_PORT,DC_MOTOR_PIN);
}

```



#### mian.c

```
#include "system.h"
#include "led.h"
#include "systick.h"
#include "beep.h"
#include "smg.h"
#include "key.h"
#include "dc_motor.h"

int main(){
	SysTick_Init(72);
	LED_Init();
	DC_MOTOR_Init();
	u8 i=0;
	while(1){
		i++;
		if(i%10==0)
			LED0=!LED0;
		if(i%100==0)
			DC_MOTOR=!DC_MOTOR;
		delay_ms(10);
	}
}

```

## 步进电机

直流电机缺点：无法控制精确角度，可以控制速度

步进电机弥补了这个缺点

![](.\img\image-20241125233925517.png)

步进电机是将电脉冲信号转变为角位移或线位移的开环控制元件

步进电机是将电脉冲信号转变为角位移或线位移的开环控制元件。在非超载的情况下，电机的转速、停止的位置只取决于脉冲信号的频率和脉冲数，而不受负载变化的影响，即给电机加一个脉冲信号，电机则转过一个步距角。这一线性关系的存在，加上步进电机只有周期性的误差而无累计误差等特点。使得在速度、位置等控制领域用步进电机来控制变的非常的简单。虽然步进电机已被广泛的应用，但步进电机并不能像普通的直流电机，交流电机在常规下使用。它必须由双环形脉冲信号、功率驱动电路等组成控制系统方可使用。因此用好步进电机也并非易事，它涉及到机械、电机、电子及计算机等多专业知识。下图即为混合式步进电机组成图。

------

![image-20241125234008864](.\img\image-20241125234008864.png)

通常步进电机的转子为永磁体，当电流流过定子绕组时，定子绕组产生一矢量磁场。磁场会带动转子旋转一定的角度，使得转子的一对磁场方向与定子的磁场方向一致。当定子的矢量磁场旋转一个角度。转子也随着该磁场转步距角。每输入一个电脉冲，电动机转动一个角度前进一步。它输出的角位移与输入的脉冲数成正比、转速与脉冲频率成正比。改变绕组通电的顺序，电机就会反转。所以可以控制脉冲数量、频率及电动机各相绕组的通电顺序来控制步进电机的转动。

### 一、步进电机工作原理

#### 1.步进电机极性区分

![image-20241125234234199](.\img\image-20241125234234199.png)

其中左侧为单极性步进电机，右侧为双极性的步进电机，从上图中不难看出区别是什么。单双极性是指一个步进电机里面有几种电流的流向，左侧的五线四相步进电机就是单极性的步进电机，图中的红色箭头为电流的走向，四根线的电流走向汇总到公共线，所以称之为单极性电机；但是右侧则不同，电机中有两个电流的回路，两个电流的回路自然就是双极性，所以称之为双极性电机。

**单极性绕组**

单极性步进电机使用的是单极性绕组。其一个电极上有两个绕组，这种联接方式为当一个绕组通电时，产生一个北极磁场；另一个绕组通电，则产生一个南极磁场。因为从驱动器到线圈的电流不会反向，所以可称其为单极绕组。

**双极性绕组**

双极性步进电机使用的是双极性绕组。每相用一个绕组，通过将绕组中电流反向，电磁极性被反向。典型的两相双极驱动的输出步骤在电气原理图和下图中的步进顺序中进一步阐述。按图所示，转换只利用绕组简单地改变电流的方向，就能改变该组的极性。

![image-20241125234353986](.\img\image-20241125234353986.png)

永磁步进电机包括一个永磁转子、线圈绕组和导磁定子，只要将线圈通电根据电磁铁的原理就会产生磁场，分为南北极，见上图所示；通过改变步进电机定子的磁场，转子就会因磁场的变化而发生转动，同理，依次改变通电的顺序就可以使得电机转动起来。

#### 2.**双极性步进电机驱动原理**

下图是一个双极性的步进电机整步，步进顺序。在第一步中：将 A 相通电，根据电磁铁原理，产生磁性，并且因异性相吸，所以磁场将转子固定在第一步的位置；第二步：当 A 相关闭，B 相通电时，转子会旋转 90°；第三步：B 相关闭、A 相通电，但极性与第 1 步相反，这促使转子再次旋转 90°。在第四步中：A 相关闭、B 相通电，极性与第 2 步相反。重复该顺序促使转子按 90°的步距角顺时针旋转

![image-20241125234454663](.\img\image-20241125234454663.png)

上图中显示的步进顺序是单相激励步进，也可以理解为每次通电产生磁性的相只有一个，要么 A 相，要么 B 相；但是更常用的是双相激励，但是在转换时，一次只能换相一次，具体详见下图：

![image-20241125234705998](.\img\image-20241125234705998.png)

上图是两相同时通电的旋转顺序，与单相激励不同的是，单相通电后被固定在了与定子正对着的绕组极性，但是双相同时激励时转子却被固定在两个绕阻的极性中间；此时通电顺序就变成了 AB 相同时通电即可。

​	在双相激励的过程中，也可以在换相位时加一个关闭相位的状态而产生走半步的现象，这将步进电机的整个步距角一分为二，例如，一个 90°的步进电机将每半步移动 45°，具体见下图。

![image-20241125234800785](.\img\image-20241125234800785.png)

1. A 相通电，B 相不通电

2. A、B 相全部通电，且电流相同，产生相同磁性

3. B 相通电，A 断电

4. B 相通电，A 相通电，且电流相等，产生相同磁性

5. A 相通电，B 断电

6. A、B 相全部通电，且电流相同，产生相同磁性

7. B 相通电，A 断电

8. B 相通电，A 相通电，且电流相等，产生相同磁性

其中 1~4 步与 5~8 步的电流方向相反（电流相反，电磁的极性就相反）这样就产生了顺时针旋转，同理逆时针是将通电顺序反过来即可。

#### 3.**单极性步进电机驱动原理**

![image-20241125235145789](.\img\image-20241125235145789.png)

上图是单极性步进电机整步旋转的过程，其中，在图示中分为 5 根线，分别为 A、B、C、D 和公共端（+），公共端需要一直通电，剩下 ABCD 相中只要有一个相通电，即可形成回路产生磁场，图中的通电顺序为 A->B->C->D，即可完成上图中的顺时针旋转，如果想要逆时针旋转只需要将其倒序即可。

​	以上是单相通电产生的整步旋转，两相通电也可以产生，两个相邻的相通电，这样相邻的两个相就都产生了回路，也就产生了磁场，图中的通电顺序为AB->BC->CD->DA，同理逆时针旋转的顺序为逆序。具体看下图：

![image-20241125235315160](.\img\image-20241125235315160.png)

综合这两张图就是单极性步进电机半步的通电顺序，具体看下图：

![image-20241125235351696](.\img\image-20241125235351696.png)

上图兼容了前两张图的所有特点，也可以说前两张图是这张图的子集，图中的通电顺序为：A->AB->B->BC->C->CD->D->DA 转子每次只走半步 45 度，所以这也被称为半步驱动，与整步相比半步的旋转方式旋转起来更加的顺滑。

#### 4.**细分驱动原理**

![image-20241125235435509](.\img\image-20241125235435509.png)

在上图中均为双相激励；其中图（a）为 A 相电流很大，B 相的电流极其微弱，接近 0；图 (C) 为 A 相和 B 相的电流相同，电流决定磁场，所以说 A 相和 B 相的磁场也是相同的，(a) 和（c）可以是极限特殊的情况，再看图（b）和图（d）这两个是由于 A 相和 B 相的电流不同产生位置情况；由此可以得出改变定子的电流比例就可以使得转子在任意角度停住。细分的原理就是：通过改变定子的电流比例，改变转子在一个整步中的不同位置，可以将一个整步分成多个小步来运行。

在上图中就是一个整步分成了 4 步来跑，从（a）~（d）是 A 相的电流逐渐减小，B 相电流逐渐增大的过程，如果驱动器的细分能力很强，可以将其分成32 细分、64 细分等；这不仅提高了步进电机旋转的顺畅度而且提高了每步的精度。细分驱动具有转动顺畅、精度高、转矩大的特点，但控制复杂，一般需要专用芯片来实现，例如东芝公司的 TB67S10xA 系列步进电机细分驱动芯片，最多可以把 1 个整步分为 32 个小步

### 二、**步进电机技术指标**

#### 1。**静态技术指标**

• 相数：产生不同对极 N、S 磁场的激磁线圈对数，也可以理解为步进电机中线圈的组数，其中两相步进电机步距角为 1.8°，三相的步进电机步距角为1.5°，相数越多的步进电机，其步距角就越小。

• 拍数：完成一个磁场周期性变化所需脉冲数或导电状态用 n 表示，或指电机转过一个齿距角所需脉冲数，以四相电机为例，有四相四拍运行方式即AB-BC-CD-DA-AB，四相八拍运行方式即 A-AB-B-BC-C-CD-D-DA-A。

• 步距角：一个脉冲信号所对应的电机转动的角度，可以简单理解为一个脉冲信号驱动的角度，电机上都有写，一般 42 步进电机的步距角为 1.8°

• 定位转矩：电机在不通电状态下，电机转子自身的锁定力矩（由磁场齿形的谐波以及机械误差造成的）。

• 静转矩：电机在额定静态电压作用下，电机不作旋转运动时，电机转轴的锁定力矩。此力矩是衡量电机体积的标准，与驱动电压及驱动电源等无关。

#### 2.**动态技术指标**

**·**步距角精度：步进电机转动一个步距角度的理论值与实际值的误差。用百分比表示：误差/步距角 *100%。

• 失步：电机运转时运转的步数，不等于理论上的步数。也可以叫做丢步，一般都是因负载太大或者是频率过快。

• 失调角：转子齿轴线偏移定子齿轴线的角度，电机运转必存在失调角，由失调角产生的误差，采用细分驱动是不能解决的。

• 最大空载起动频率：在不加负载的情况下，能够直接起动的最大频率。

• 最大空载的运行频率：电机不带负载的最高转速频率。

• 运行转矩特性：电机的动态力矩取决于电机运行时的平均电流（而非静态电流），平均电流越大，电机输出力矩越大，即电机的频率特性越硬。• 电机正反转控制：通过改变通电顺序而改变电机的正反转。

### 三、**28BYJ-48** **步进电机**

28BYJ48 步进电机自带减速器，为四相无线步进电机，直径为 28mm

![image-20241125235904877](.\img\image-20241125235904877.png)

28BYJ48 步进电机旋转驱动方式如下表

![image-20241125235925226](.\img\image-20241125235925226.png)

28BYJ48 步进电机主要参数如下所示

![image-20241125235950504](.\img\image-20241125235950504.png)

在上图中 28BYJ48 步进电机主要参数中可以看到有一个减速比：1:64，步进角为 5.625/64 度，如果需要转动一圈，那么需要 360/5.625*64=4096 个脉冲信号。减速比这个和之前介绍的直流减速电机有点类似，所以 28BYJ48 步进电机实际上是：减速齿轮+步进电机组成，28BYJ48 步进电机减速齿轮实物图如下所示：减速齿轮计算方法如下所示：

![image-20241126000122635](.\img\image-20241126000122635.png)

### 四、软件设计

